<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <meta property="og:title" content="Açaí Ellegance | Pedido Premium">
    <meta property="og:description" content="Sabor inigualável. Peça agora.">
    <meta property="og:image" content="logoacai.jpeg">
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logoacai.jpeg">

    <title>Açaí Ellegance</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Outfit:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        display: ['"Outfit"', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            900: '#4c1d95',
                        },
                        whatsapp: {
                            500: '#25D366',
                            600: '#128C7E',
                        }
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                        'glow': '0 0 20px rgba(124, 58, 237, 0.3)',
                        'whatsapp': '0 10px 25px -5px rgba(37, 211, 102, 0.4)',
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 4s ease-in-out infinite',
                        'pulse-green': 'pulse-green 2s infinite',
                    },
                    keyframes: {
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        'pulse-green': {
                            '0%': { boxShadow: '0 0 0 0 rgba(37, 211, 102, 0.7)' },
                            '70%': { boxShadow: '0 0 0 15px rgba(37, 211, 102, 0)' },
                            '100%': { boxShadow: '0 0 0 0 rgba(37, 211, 102, 0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos para Mobile */
        body { 
            background-color: #fafafa; 
            -webkit-tap-highlight-color: transparent; 
            overscroll-behavior-y: contain;
            -webkit-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .glass { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px); 
            border-bottom: 1px solid rgba(255,255,255,0.5); 
        }
        
        /* Product Card */
        .product-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            opacity: 0; 
            animation: slideUp 0.5s ease-out forwards; 
        }
        .product-card:active { transform: scale(0.97); }
        .product-card.selected { 
            border-color: #7c3aed; 
            background: linear-gradient(to bottom right, #fcfaff, #f3e8ff); 
            box-shadow: 0 8px 30px -5px rgba(124, 58, 237, 0.2); 
            transform: translateY(-2px); 
        }

        .check-circle { transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .selected .check-circle { background-color: #7c3aed; border-color: #7c3aed; transform: scale(1.1) rotate(360deg); }
        .selected .check-icon { opacity: 1; transform: scale(1); }
        
        .spinner { 
            border: 2px solid rgba(255,255,255,0.3); 
            border-left-color: #fff; 
            border-radius: 50%; 
            width: 20px; 
            height: 20px; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Safe areas for notched phones */
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
        .safe-pt { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="antialiased text-slate-800 bg-slate-50 overflow-x-hidden">

    <!-- SPLASH SCREEN -->
    <div id="splash" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white transition-opacity duration-500">
        <div class="relative mb-6">
            <div class="absolute inset-0 bg-brand-500/20 blur-xl rounded-full animate-pulse"></div>
            <img src="logoacai.jpeg" class="w-32 h-32 object-cover rounded-full shadow-2xl relative z-10 border-4 border-white animate-bounce-short">
        </div>
        <h1 class="font-display font-bold text-3xl text-slate-900 tracking-tight">Açaí Ellegance</h1>
        <p class="text-slate-400 text-xs font-bold mt-3 tracking-widest uppercase bg-slate-100 px-3 py-1 rounded-full">Carregando Sabores</p>
    </div>

    <div class="app-container relative min-h-screen pb-32 z-10 flex flex-col items-center">
        
        <!-- HEADER -->
        <header class="sticky top-0 z-40 glass shadow-sm w-full safe-pt">
            <div class="px-5 h-[72px] flex items-center justify-between max-w-lg mx-auto">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="window.handleAdminClick()">
                    <div class="relative transition-transform group-active:scale-95">
                        <img src="logoacai.jpeg" class="w-11 h-11 rounded-full border-2 border-white shadow-md object-cover">
                        <div id="status-indicator" class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-slate-300 border-2 border-white rounded-full transition-colors duration-500"></div>
                    </div>
                    <div>
                        <h1 class="font-display font-extrabold text-lg leading-tight text-slate-900 tracking-tight">Açaí Ellegance</h1>
                        <div class="flex items-center gap-1">
                            <span id="status-dot" class="w-1.5 h-1.5 rounded-full bg-slate-300"></span>
                            <p id="status-text" class="text-[10px] font-bold uppercase tracking-wider text-slate-400">Conectando...</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="window.toggleCart(true)" class="relative p-3 rounded-2xl bg-white border border-slate-100 shadow-sm active:scale-90 text-brand-600 transition-all">
                    <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-brand-600 text-white text-[9px] font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white transform scale-0 transition-transform shadow-sm">0</span>
                </button>
            </div>
            
            <!-- CATEGORIAS (Scroll Horizontal Suave) -->
            <div class="px-5 pb-3 pt-1 overflow-x-auto no-scrollbar w-full max-w-lg mx-auto">
                <div class="flex gap-2 w-max">
                    <button onclick="filterCategory('Todos')" class="cat-btn active px-6 py-2.5 rounded-full text-xs font-black bg-brand-900 text-white shadow-lg whitespace-nowrap active:scale-95 transition-all" data-cat="Todos">Todos</button>
                    <button onclick="filterCategory('Tradicional')" class="cat-btn px-6 py-2.5 rounded-full text-xs font-black bg-white text-slate-500 border border-slate-200 whitespace-nowrap active:scale-95 transition-all" data-cat="Tradicional">Tradicional</button>
                    <button onclick="filterCategory('Gourmet')" class="cat-btn px-6 py-2.5 rounded-full text-xs font-black bg-white text-slate-500 border border-slate-200 whitespace-nowrap active:scale-95 transition-all" data-cat="Gourmet">Gourmet</button>
                </div>
            </div>
        </header>

        <!-- CONTEÚDO PRINCIPAL -->
        <main class="px-5 pt-6 w-full max-w-lg space-y-8 flex-1">
            
            <!-- DESTAQUE (Banner amigável para polegar) -->
            <div class="relative w-full h-48 rounded-[2.5rem] overflow-hidden shadow-2xl shadow-purple-900/20 group cursor-pointer active:scale-[0.98] transition-transform" onclick="filterCategory('Gourmet')">
                <img src="logoacai.jpeg" class="absolute inset-0 w-full h-full object-cover opacity-90 transition-transform duration-1000 ease-out">
                <div class="absolute inset-0 bg-gradient-to-r from-brand-900 via-brand-900/50 to-transparent"></div>
                <div class="absolute inset-0 p-8 flex flex-col justify-center text-white">
                    <div class="bg-white/20 backdrop-blur-md px-3 py-1 rounded-lg w-fit mb-3 border border-white/20 shadow-sm">
                        <span class="text-[10px] font-black uppercase tracking-widest flex items-center gap-1"><i data-lucide="star" class="w-3 h-3 fill-yellow-400 text-yellow-400"></i> Premium</span>
                    </div>
                    <h2 class="font-display font-bold text-4xl mb-2 drop-shadow-md">Linha<br>Gourmet</h2>
                    <p class="text-brand-50 text-xs font-medium opacity-90 max-w-[60%]">A cremosidade que você merece.</p>
                </div>
            </div>

            <!-- BUSCA -->
            <div class="relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-5 h-5 text-slate-400 group-focus-within:text-brand-600 transition-colors"></i>
                </div>
                <input type="text" id="search-input" onkeyup="filterMenu()" placeholder="O que você deseja hoje?" class="w-full pl-12 pr-4 py-4 bg-white rounded-2xl border border-slate-100 shadow-soft text-sm font-semibold placeholder:text-slate-400 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500/50 outline-none transition-all">
            </div>

            <!-- GRELHA DE PRODUTOS -->
            <div id="products-grid" class="grid grid-cols-1 gap-4 pb-10"></div>

            <!-- OBSERVAÇÕES -->
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                <label class="flex items-center gap-2 text-xs font-black text-slate-400 uppercase mb-3 tracking-wide">
                    <i data-lucide="message-square" class="w-3.5 h-3.5 text-brand-500"></i> Alguma observação?
                </label>
                <textarea id="obs-input" rows="2" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm focus:bg-white focus:ring-4 focus:ring-brand-500/10 outline-none resize-none placeholder:text-slate-400 text-slate-700 transition-all" placeholder="Ex: Caprichar no leite condensado..."></textarea>
            </div>

        </main>

        <!-- MARCA D'ÁGUA (CANTO ESQUERDO) -->
        <div class="fixed bottom-32 left-4 z-30 pointer-events-none animate-float hidden sm:block md:block lg:block">
            <div class="flex flex-col">
                <span class="text-[8px] font-black uppercase tracking-[0.3em] text-slate-400 mb-0.5 ml-1">By</span>
                <span class="text-[10px] font-extrabold uppercase tracking-widest text-slate-700 bg-white/70 backdrop-blur-md px-3 py-1.5 rounded-lg border border-slate-200 shadow-md">
                    Ferreira Web Designer
                </span>
            </div>
        </div>
        
        <!-- Marca d'água Mobile Simplificada -->
        <div class="fixed bottom-[130px] left-5 z-30 pointer-events-none opacity-50 sm:hidden">
            <span class="text-[9px] font-black uppercase tracking-[0.2em] text-slate-400 bg-white/40 px-2 py-1 rounded-md">Ferreira Web Designer</span>
        </div>

        <!-- WHATSAPP FLUTUANTE (CANTO DIREITO) -->
        <button onclick="window.openChat()" class="fixed bottom-32 right-6 z-40 w-14 h-14 bg-whatsapp-500 text-white rounded-full shadow-whatsapp flex items-center justify-center animate-pulse-green active:scale-90 transition-all">
            <i data-lucide="message-circle" class="w-8 h-8 fill-white/10"></i>
        </button>

        <!-- BARRA DE COMPRA INFERIOR (Estilo App) -->
        <div class="fixed bottom-0 left-0 right-0 z-50 p-4 bg-gradient-to-t from-white via-white to-transparent pt-10 pointer-events-none safe-pb">
            <div class="max-w-lg mx-auto flex items-center gap-3 pointer-events-auto">
                <div class="bg-white h-16 px-2 rounded-2xl shadow-xl border border-slate-100 flex items-center min-w-[120px]">
                    <button onclick="updateQty(-1)" class="w-12 h-full flex items-center justify-center text-slate-400 active:text-brand-600 active:scale-75 transition-all text-2xl font-bold rounded-xl">-</button>
                    <span id="qty-display" class="flex-1 text-center font-display font-black text-xl text-slate-800">1</span>
                    <button onclick="updateQty(1)" class="w-12 h-full flex items-center justify-center text-slate-400 active:text-brand-600 active:scale-75 transition-all text-2xl font-bold rounded-xl">+</button>
                </div>
                <button onclick="addToCart()" id="btn-add" class="flex-1 h-16 bg-slate-900 text-white rounded-2xl shadow-xl flex items-center justify-between px-6 active:scale-95 transition-all disabled:opacity-50 disabled:grayscale group">
                    <span class="text-xs font-black uppercase tracking-widest transition-all">Adicionar</span>
                    <span id="price-display" class="font-display font-bold text-lg bg-white/10 px-2 py-1 rounded-lg">R$ 0,00</span>
                </button>
            </div>
        </div>

    </div>

    <!-- CARRINHO DRAWER (Otimizado para Mobile) -->
    <div id="cart-backdrop" class="fixed inset-0 z-[60] bg-slate-900/40 backdrop-blur-sm invisible opacity-0 transition-all duration-300" onclick="window.toggleCart(false)"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 bottom-0 z-[70] w-full max-w-md bg-white shadow-2xl translate-x-full transition-transform duration-300 flex flex-col">
        <div class="px-6 py-6 border-b border-slate-50 flex items-center justify-between bg-white/90 backdrop-blur-md sticky top-0 z-10 safe-pt">
            <div>
                <h2 class="font-display font-black text-2xl text-slate-900 tracking-tight">Seu Carrinho</h2>
                <p class="text-xs text-slate-400 font-medium">Confira os sabores escolhidos</p>
            </div>
            <button onclick="toggleCart(false)" class="p-3 bg-slate-50 active:bg-slate-100 rounded-full transition-colors"><i data-lucide="x" class="w-6 h-6 text-slate-500"></i></button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 space-y-6 bg-slate-50/50 no-scrollbar">
            <div id="cart-items" class="space-y-4"></div>
            
            <div id="checkout-form" class="hidden space-y-6 bg-white p-6 rounded-[2.5rem] border border-slate-100 shadow-sm">
                <div class="space-y-4">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="user" class="w-4 h-4 text-brand-500"></i> Seus Dados</h3>
                    <div class="space-y-3">
                        <input id="client-name" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-bold border-2 border-transparent focus:border-brand-500/20 focus:bg-white outline-none transition-all" placeholder="Nome Completo">
                        <input id="client-phone" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-bold border-2 border-transparent focus:border-brand-500/20 focus:bg-white outline-none transition-all" placeholder="Telefone (WhatsApp)" maxlength="15">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4 text-brand-500"></i> Entrega</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="setDelivery('Retirada')" id="btn-retirada" class="p-4 border-2 border-slate-100 rounded-2xl text-xs font-black text-slate-400 active:bg-slate-50 transition-all uppercase tracking-wide">Retirada</button>
                        <button onclick="setDelivery('Entrega')" id="btn-entrega" class="p-4 border-2 border-slate-100 rounded-2xl text-xs font-black text-slate-400 active:bg-slate-50 transition-all uppercase tracking-wide">Entrega</button>
                    </div>
                    <div id="delivery-details" class="hidden space-y-3 animate-slide-up">
                        <select id="delivery-zone" class="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl text-sm font-bold outline-none focus:border-brand-500 transition-colors" onchange="renderCart()"></select>
                        <textarea id="client-address" rows="2" class="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl text-sm font-medium outline-none resize-none focus:border-brand-500 transition-colors" placeholder="Endereço completo (Rua, Nº, Bairro, Ref)"></textarea>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest flex items-center gap-2"><i data-lucide="credit-card" class="w-4 h-4 text-brand-500"></i> Pagamento</h3>
                    <select id="payment-method" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-bold border-2 border-transparent focus:bg-white focus:border-brand-500/20 outline-none transition-all" onchange="handlePaymentChange()">
                        <option value="" disabled selected>Forma de pagamento...</option>
                        <option value="Pix">Pix (Copia e Cola)</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Cartão">Cartão na Entrega</option>
                    </select>
                    
                    <div id="pix-area" class="hidden bg-brand-50 p-5 rounded-3xl border border-brand-100 text-center animate-slide-up">
                        <p class="text-[10px] font-black text-brand-900 uppercase mb-1 tracking-widest">Titular: Gabriel Santana Morais</p>
                        <p class="text-[10px] font-black text-brand-900 uppercase mb-3 tracking-widest">Chave Pix</p>
                        <div class="flex gap-2 mb-4">
                            <input id="pix-key" readonly class="flex-1 text-[10px] text-center p-3 rounded-xl bg-white border border-brand-100 text-slate-500 outline-none font-mono">
                            <button onclick="copyPix()" class="p-3 bg-brand-600 text-white rounded-xl active:bg-brand-700 transition-colors shadow-lg"><i data-lucide="copy" class="w-4 h-4"></i></button>
                        </div>
                        <button onclick="confirmPix()" id="btn-pix-confirm" class="w-full py-4 bg-brand-600 text-white rounded-2xl text-xs font-bold active:scale-95 transition-all shadow-lg">
                            <span>Já enviei o comprovante</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RODAPÉ DO CARRINHO -->
        <div class="p-6 border-t border-slate-100 bg-white z-20 shadow-[0_-10px_60px_-15px_rgba(0,0,0,0.1)] safe-pb">
            <div class="flex justify-between items-end mb-5">
                <span class="text-xs font-black text-slate-400 uppercase tracking-widest">Total Geral</span>
                <span id="cart-total" class="text-3xl font-display font-black text-slate-900 tracking-tight">R$ 0,00</span>
            </div>
            <button onclick="sendOrder()" id="btn-checkout" class="w-full py-5 rounded-2xl bg-gradient-to-r from-whatsapp-500 to-whatsapp-600 text-white font-black text-sm shadow-xl flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50 disabled:grayscale" disabled>
                <div class="relative z-10 flex items-center gap-2">
                    <i data-lucide="message-circle" class="w-6 h-6 fill-white/20"></i>
                    <span>Enviar Pedido no WhatsApp</span>
                </div>
            </button>
        </div>
    </div>

    <!-- PAINEL ADMIN E TOAST MANTIDOS CONFORME ANTERIOR -->
    <div id="admin-modal" class="fixed inset-0 z-[80] bg-slate-900/60 backdrop-blur-md hidden flex items-center justify-center p-6 transition-all">
        <div class="bg-white w-full max-w-sm p-8 rounded-[2rem] shadow-2xl animate-slide-up relative">
            <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="absolute top-5 right-5 text-slate-300 hover:text-slate-600"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-brand-50 rounded-2xl flex items-center justify-center mx-auto mb-4 text-brand-600 shadow-inner">
                    <i data-lucide="lock" class="w-8 h-8"></i>
                </div>
                <h3 class="font-display font-bold text-2xl text-slate-900">Acesso Restrito</h3>
                <p class="text-xs text-slate-400 font-medium mt-1">Painel Administrativo</p>
            </div>
            <div class="space-y-4">
                <input type="email" id="adm-email" placeholder="Email de Acesso" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-semibold outline-none focus:ring-2 focus:ring-brand-500/20 transition-all">
                <input type="password" id="adm-pass" placeholder="Senha" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-semibold outline-none focus:ring-2 focus:ring-brand-500/20 transition-all text-center tracking-widest">
                <button onclick="adminLogin()" class="w-full py-4 bg-brand-900 text-white rounded-2xl font-bold text-sm hover:bg-brand-800 transition-all shadow-lg shadow-brand-900/30 active:scale-95">Acessar Painel</button>
            </div>
        </div>
    </div>

    <div id="admin-panel" class="fixed inset-0 z-[90] bg-slate-50 hidden overflow-y-auto">
        <div class="bg-white px-6 py-5 sticky top-0 z-10 flex justify-between items-center shadow-sm border-b border-slate-100 safe-pt">
            <div>
                <h2 class="font-display font-bold text-xl text-slate-900">Dashboard</h2>
                <p class="text-[10px] text-green-600 font-bold bg-green-50 px-2 py-0.5 rounded-md inline-block mt-1">● Sistema Online</p>
            </div>
            <button onclick="adminLogout()" class="text-xs font-bold text-red-600 bg-red-50 border border-red-100 px-4 py-2.5 rounded-xl active:bg-red-100 transition-colors">Sair</button>
        </div>
        
        <div class="p-6 space-y-6 max-w-lg mx-auto pb-24">
            <div class="flex p-1 bg-slate-100 rounded-xl mb-4">
                <button onclick="switchAdminTab('pedidos')" id="tab-pedidos" class="flex-1 py-2 text-xs font-bold rounded-lg bg-white shadow-sm text-slate-800 transition-all">Pedidos</button>
                <button onclick="switchAdminTab('config')" id="tab-config" class="flex-1 py-2 text-xs font-bold rounded-lg text-slate-500 transition-all">Configurações</button>
            </div>

            <div id="view-pedidos" class="space-y-4">
                <div id="admin-orders-list" class="space-y-3">
                    <div class="text-center py-10 text-slate-400 text-xs">Carregando pedidos...</div>
                </div>
            </div>

            <div id="view-config" class="hidden space-y-6">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <div class="flex items-center gap-3 mb-5">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-blue-600"><i data-lucide="store" class="w-5 h-5"></i></div>
                        <h3 class="text-sm font-black text-slate-800 uppercase tracking-wide">Status da Loja</h3>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="setStatus('open')" id="st-open" class="flex-1 py-4 rounded-2xl border-2 border-slate-100 text-xs font-black text-slate-400 active:bg-slate-50 transition-all">ABRIR</button>
                        <button onclick="setStatus('auto')" id="st-auto" class="flex-1 py-4 rounded-2xl border-2 border-slate-100 text-xs font-black text-slate-400 active:bg-slate-50 transition-all">AUTO</button>
                        <button onclick="setStatus('closed')" id="st-closed" class="flex-1 py-4 rounded-2xl border-2 border-slate-100 text-xs font-black text-slate-400 active:bg-slate-50 transition-all">FECHAR</button>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-4">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 rounded-full bg-purple-50 flex items-center justify-center text-purple-600"><i data-lucide="settings-2" class="w-5 h-5"></i></div>
                        <h3 class="text-sm font-black text-slate-800 uppercase tracking-wide">Dados Gerais</h3>
                    </div>
                    <input id="cfg-name" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-medium outline-none" placeholder="Nome Loja">
                    <input id="cfg-phone" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-medium outline-none" placeholder="WhatsApp (55...)">
                    <div class="grid grid-cols-2 gap-3">
                        <input id="cfg-pix-key" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-medium outline-none" placeholder="Chave Pix">
                        <input id="cfg-pix-name" class="w-full p-4 bg-slate-50 rounded-2xl text-sm font-medium outline-none" placeholder="Nome Titular">
                    </div>
                    <button onclick="saveSettings()" class="w-full py-4 bg-brand-900 text-white rounded-2xl font-bold text-sm mt-4 active:bg-brand-800 transition-all shadow-lg">Salvar Tudo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-900/90 backdrop-blur-md text-white px-6 py-4 rounded-full shadow-2xl opacity-0 pointer-events-none z-[110] transition-all duration-500 transform -translate-y-20 flex items-center gap-3 justify-center border border-white/10">
        <div class="w-2.5 h-2.5 bg-green-400 rounded-full animate-pulse"></div>
        <span class="text-xs font-bold tracking-wide" id="toast-msg">Sucesso</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc, addDoc, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBakH1kufhFKj-ibAkQNTXhs-WLfxUob28",
            authDomain: "acai-ellegance-app.firebaseapp.com",
            projectId: "acai-ellegance-app",
            storageBucket: "acai-ellegance-app.firebasestorage.app",
            messagingSenderId: "190829563894",
            appId: "1:190829563894:web:8494b3663cdd381e5281d7"
        };

        const DEFAULT_ITEMS = [
            { name: "Paçoca 300ml", description: "Açaí, paçoca, banana e leite condensado", price: 10.00, category: "Tradicional" },
            { name: "Ninho 300ml", description: "Açaí, leite em pó, banana e leite condensado", price: 10.00, category: "Tradicional" },
            { name: "Amendoim 300ml", description: "Açaí, amendoim, banana e leite condensado", price: 10.00, category: "Tradicional" },
            { name: "Cupuaçu 300ml", description: "Açaí, cupuaçu, leite condensado", price: 10.00, category: "Tradicional" },
            { name: "Paçoca 500ml", description: "Açai, paçoca, banana e leite condensado", price: 14.00, category: "Tradicional" },
            { name: "Ninho 500ml", description: "Açai, leite em pó, banana e leite condensado", price: 14.00, category: "Tradicional" },
            { name: "Amendoim 500ml", description: "Açai, amendoim, banana e leite condensado", price: 14.00, category: "Tradicional" },
            { name: "Cupuaçu 500ml", description: "Açai, cupuaçu e leite condensado", price: 14.00, category: "Tradicional" },
            { name: "Morango 300ml", description: "Açaí, morango, creme de morango", price: 13.00, category: "Gourmet" },
            { name: "Maracujá 300ml", description: "Açaí, creme de maracujá e leite condensado", price: 13.00, category: "Gourmet" },
            { name: "Ovomaltine 300ml", description: "Açaí, ovomaltine, nutella", price: 13.00, category: "Gourmet" },
            { name: "Creme de Ninho 300ml", description: "Açaí, leite em pó, creme de ninho", price: 13.00, category: "Gourmet" },
            { name: "M&M 300ml", description: "Açaí, leite em pó, nutella e M&M", price: 13.00, category: "Gourmet" },
            { name: "Morango com Nutella 500ml", description: "Açaí, morango, nutella", price: 18.00, category: "Gourmet" },
            { name: "Ovomaltine 500ml", description: "Açaí, ovomaltine e nutella", price: 18.00, category: "Gourmet" }
        ];

        let state = {
            cart: [],
            config: {
                storeName: "Açaí Ellegance",
                phone: "557998168282",
                statusMode: 'auto',
                sizes: DEFAULT_ITEMS,
                pixKey: "57970392000139",
                pixName: "Gabriel Santana Morais",
                googleScriptUrl: "https://script.google.com/macros/s/AKfycbxxZN8J-SSftroUFlwsunzw7reWAn-kxkwJ0BG0wXvSdHq8ctCMATGsjU_gTDH4njzU/exec",
                zones: [
                    {name: "Albano Franco", price: 0},
                    {name: "Marcos Freire 1,2,3", price: 0},
                    {name: "João Alves", price: 0},
                    {name: "Fernando Collor", price: 0},
                    {name: "Piabeta", price: 0},
                    {name: "Bairro industrial", price: 4.00},
                    {name: "Porto D’antas", price: 3.00},
                    {name: "Lamarão", price: 6.00},
                    {name: "Japaozinho", price: 4.00},
                    {name: "Cidade nova", price: 5.00},
                    {name: "Barra", price: 6.00},
                    {name: "Sede de socorro", price: 4.00}
                ]
            },
            selectedItems: new Set(),
            qty: 1,
            filter: 'Todos',
            deliveryType: 'Retirada',
            paymentVerified: false,
            isAdmin: false
        };

        let db, auth;

        window.init = async () => {
            const savedCart = localStorage.getItem('acai_cart_v3');
            if(savedCart) state.cart = JSON.parse(savedCart);
            setTimeout(() => {
                document.getElementById('splash').style.opacity = '0';
                setTimeout(() => document.getElementById('splash').style.display = 'none', 500);
            }, 1500);
            setupPhoneMask();
            renderMenu();
            renderCart();
            updateUI();

            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
                onAuthStateChanged(auth, (user) => {
                    state.isAdmin = !!(user && user.email);
                    if(state.isAdmin) {
                        showAdminPanel();
                        loadAdminOrders();
                    } else {
                        signInAnonymously(auth).catch(() => {});
                    }
                });
                onSnapshot(doc(db, 'loja', 'configuracao'), (snap) => {
                    if(snap.exists()) {
                        state.config = { ...state.config, ...snap.data() };
                        renderMenu();
                        updateUI();
                        if(state.isAdmin) syncAdminFields();
                    }
                });
            } catch(e) { console.log("Modo Offline"); }
            setInterval(updateUI, 60000);
        };

        window.openChat = () => {
            const msg = "Olá! Gostaria de tirar uma dúvida.";
            window.open(`https://api.whatsapp.com/send?phone=${state.config.phone.replace(/\D/g,'')}&text=${encodeURIComponent(msg)}`, '_blank');
        };

        window.loadAdminOrders = () => {
            const q = query(collection(db, "pedidos"), orderBy("date", "desc"), limit(20));
            onSnapshot(q, (snapshot) => {
                const list = document.getElementById("admin-orders-list");
                list.innerHTML = "";
                if(snapshot.empty) {
                    list.innerHTML = '<div class="text-center py-10 text-slate-400 text-xs">Sem pedidos recentes.</div>';
                    return;
                }
                snapshot.forEach((doc) => {
                    const order = doc.data();
                    const status = order.status || 'new';
                    const isPixPending = order.paymentMethod === 'Pix' && status === 'new';
                    let statusBadge = '';
                    if(status === 'canceled') statusBadge = '<span class="badge-canceled px-2 py-0.5 rounded text-[10px] font-bold">Cancelado</span>';
                    else if(isPixPending) statusBadge = '<span class="badge-pending px-2 py-0.5 rounded text-[10px] font-bold">Pix Pendente</span>';
                    else statusBadge = '<span class="badge-paid px-2 py-0.5 rounded text-[10px] font-bold">Aprovado</span>';

                    list.innerHTML += `
                        <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h4 class="font-bold text-slate-800 text-sm">${order.clientName}</h4>
                                    <p class="text-[10px] text-slate-400">${new Date(order.date).toLocaleString()}</p>
                                </div>
                                ${statusBadge}
                            </div>
                            <div class="text-xs text-slate-600 mb-3 bg-slate-50 p-2 rounded-lg">${order.itemsSummary}</div>
                            <div class="flex justify-between items-center border-t border-slate-50 pt-2">
                                <span class="font-bold text-slate-800">${order.total}</span>
                                <div class="flex gap-2">
                                    ${isPixPending ? `<button onclick="updateOrderStatus('${doc.id}', 'paid')" class="px-3 py-1.5 bg-green-500 text-white rounded-lg text-xs font-bold shadow-sm">Confirmar Pix</button>` : ''}
                                    ${status !== 'canceled' ? `<button onclick="updateOrderStatus('${doc.id}', 'canceled')" class="p-1.5 text-red-400 active:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>` : ''}
                                </div>
                            </div>
                        </div>`;
                });
                window.refreshIcons();
            });
        };

        window.updateOrderStatus = async (orderId, newStatus) => {
            try {
                await updateDoc(doc(db, "pedidos", orderId), { status: newStatus });
                toast(newStatus === 'paid' ? "Pix Confirmado!" : "Pedido Atualizado");
            } catch(e) { toast("Erro ao atualizar", "error"); }
        };

        window.switchAdminTab = (tab) => {
            ['pedidos', 'config'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`tab-${v}`).className = "flex-1 py-2 text-xs font-bold rounded-lg text-slate-500 transition-all";
            });
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).className = "flex-1 py-2 text-xs font-bold rounded-lg bg-white shadow-sm text-slate-800 transition-all";
        };

        window.renderMenu = () => {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = "";
            let found = false;
            const term = document.getElementById('search-input').value.toLowerCase();
            state.config.sizes.forEach((item, idx) => {
                if(item.available === false) return;
                const matches = item.name.toLowerCase().includes(term) || item.description.toLowerCase().includes(term);
                if((state.filter === 'Todos' || item.category === state.filter) && matches) {
                    found = true;
                    const isSel = state.selectedItems.has(item.name);
                    const div = document.createElement('div');
                    div.style.animationDelay = `${idx * 0.05}s`;
                    div.className = `product-card bg-white p-4 rounded-[24px] border border-slate-100 flex items-center gap-4 cursor-pointer select-none relative overflow-hidden ${isSel ? 'selected' : ''}`;
                    div.onclick = () => toggleSelection(item.name, div);
                    const isGourmet = item.category === 'Gourmet';
                    div.innerHTML = `
                        <div class="relative w-[72px] h-[72px] rounded-2xl ${isGourmet ? 'text-pink-500 bg-pink-50' : 'text-brand-600 bg-brand-50'} flex items-center justify-center shrink-0 shadow-sm overflow-hidden">
                            <i data-lucide="${isGourmet ? 'sparkles' : 'snowflake'}" class="w-8 h-8 relative z-10"></i>
                            <div class="absolute -bottom-4 -right-4 w-12 h-12 bg-current opacity-10 rounded-full blur-sm"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-bold text-slate-800 text-sm leading-tight">${item.name}</h3>
                                    <p class="text-[11px] text-slate-400 mt-0.5 line-clamp-2 leading-tight">${item.description}</p>
                                </div>
                                <div class="check-circle w-6 h-6 rounded-full border-2 border-slate-200 flex items-center justify-center shrink-0 ml-2 ${isSel ? 'bg-brand-600 border-brand-600' : 'bg-white'}">
                                    <i data-lucide="check" class="check-icon w-3.5 h-3.5 text-white transition-all duration-300 ${isSel ? 'opacity-100 scale-100' : 'opacity-0 scale-50'} stroke-[3]"></i>
                                </div>
                            </div>
                            <div class="mt-2 flex items-center gap-2">
                                <span class="font-display font-bold text-slate-900">R$ ${item.price.toFixed(2).replace('.',',')}</span>
                                ${isGourmet ? '<span class="text-[9px] font-bold text-pink-600 bg-pink-50 px-2 py-0.5 rounded-full border border-pink-100">GOURMET</span>' : ''}
                            </div>
                        </div>`;
                    grid.appendChild(div);
                }
            });
            if(!found) grid.innerHTML = `<div class="text-center py-10 text-slate-400 text-sm">Nada encontrado.</div>`;
            window.refreshIcons();
        };

        window.toggleSelection = (name, el) => {
            if(state.selectedItems.has(name)) state.selectedItems.delete(name);
            else state.selectedItems.add(name);
            renderMenu();
            updateTotalBar();
        };

        window.updateTotalBar = () => {
            let total = 0;
            state.config.sizes.forEach(i => { if(state.selectedItems.has(i.name)) total += i.price; });
            const final = total * state.qty;
            document.getElementById('price-display').innerText = `R$ ${final.toFixed(2).replace('.',',')}`;
            const btn = document.getElementById('btn-add');
            if(final > 0) {
                btn.disabled = false;
                btn.classList.remove('bg-slate-900');
                btn.classList.add('bg-brand-900');
            } else {
                btn.disabled = true;
                btn.classList.remove('bg-brand-900');
                btn.classList.add('bg-slate-900');
            }
        };

        window.addToCart = () => {
            if(state.selectedItems.size === 0) return toast("Selecione um sabor!", "error");
            const obs = document.getElementById('obs-input').value.trim();
            state.config.sizes.forEach(i => {
                if(state.selectedItems.has(i.name)) {
                    const idx = state.cart.findIndex(c => c.name === i.name && c.obs === obs);
                    if(idx > -1) state.cart[idx].qty += state.qty;
                    else state.cart.push({ id: Date.now()+Math.random(), name: i.name, price: i.price, obs, qty: state.qty });
                }
            });
            state.selectedItems.clear();
            state.qty = 1;
            document.getElementById('qty-display').innerText = "1";
            document.getElementById('obs-input').value = "";
            renderMenu();
            updateTotalBar();
            saveCart();
            renderCart();
            toast("Adicionado!");
            setTimeout(() => toggleCart(true), 300);
        };

        function saveCart() { localStorage.setItem('acai_cart_v3', JSON.stringify(state.cart)); }

        window.renderCart = () => {
            const list = document.getElementById('cart-items');
            list.innerHTML = "";
            let subtotal = 0;
            let count = 0;
            if(state.cart.length === 0) {
                list.innerHTML = `<div class="flex flex-col items-center justify-center py-10 opacity-50"><i data-lucide="shopping-cart" class="w-12 h-12 text-slate-300 mb-2"></i><p class="text-sm font-bold text-slate-400">Vazio</p></div>`;
                document.getElementById('checkout-form').classList.add('hidden');
            } else {
                document.getElementById('checkout-form').classList.remove('hidden');
                state.cart.forEach(item => {
                    subtotal += item.price * item.qty;
                    count += item.qty;
                    list.innerHTML += `
                        <div class="flex justify-between items-start bg-white p-4 rounded-2xl border border-slate-100 shadow-sm animate-slide-up">
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="bg-brand-50 text-brand-600 text-[10px] font-black px-2 py-0.5 rounded-lg">${item.qty}x</span>
                                    <span class="font-bold text-sm text-slate-800">${item.name}</span>
                                </div>
                                ${item.obs ? `<p class="text-[10px] text-slate-400 mt-1.5 italic bg-slate-50 p-1.5 rounded-lg inline-block">"${item.obs}"</p>` : ''}
                                <p class="text-xs font-bold text-brand-600 mt-1.5">R$ ${(item.price * item.qty).toFixed(2).replace('.',',')}</p>
                            </div>
                            <div class="flex items-center bg-slate-50 rounded-xl h-9 border border-slate-200">
                                <button onclick="modCartItem(${item.id}, -1)" class="w-9 active:text-red-500 font-bold">-</button>
                                <button onclick="modCartItem(${item.id}, 1)" class="w-9 active:text-green-500 font-bold">+</button>
                            </div>
                        </div>`;
                });
            }
            let shipping = 0;
            if(state.deliveryType === 'Entrega') shipping = parseFloat(document.getElementById('delivery-zone').value || 0);
            document.getElementById('cart-total').innerText = `R$ ${(subtotal + shipping).toFixed(2).replace('.',',')}`;
            const badge = document.getElementById('cart-count');
            badge.innerText = count;
            badge.className = `absolute -top-1 -right-1 bg-brand-600 text-white text-[9px] font-bold w-5 h-5 flex items-center justify-center rounded-full border-2 border-white transform transition-transform shadow-sm ${count > 0 ? 'scale-100' : 'scale-0'}`;
            validateCheckout();
            window.refreshIcons();
        };

        window.modCartItem = (id, d) => {
            const idx = state.cart.findIndex(c => c.id === id);
            if(idx > -1) {
                state.cart[idx].qty += d;
                if(state.cart[idx].qty <= 0) state.cart.splice(idx, 1);
                saveCart();
                renderCart();
            }
        };

        window.setDelivery = (type) => {
            state.deliveryType = type;
            const btnRet = document.getElementById('btn-retirada');
            const btnEnt = document.getElementById('btn-entrega');
            const details = document.getElementById('delivery-details');
            const base = "p-4 border-2 rounded-2xl text-xs font-black uppercase tracking-wide transition-all";
            if(type === 'Retirada') {
                btnRet.className = `${base} border-brand-600 bg-brand-50 text-brand-700`;
                btnEnt.className = `${base} border-slate-100 text-slate-400`;
                details.classList.add('hidden');
            } else {
                btnEnt.className = `${base} border-brand-600 bg-brand-50 text-brand-700`;
                btnRet.className = `${base} border-slate-100 text-slate-400`;
                details.classList.remove('hidden');
                const sel = document.getElementById('delivery-zone');
                if(sel.options.length === 0) {
                    sel.innerHTML = '<option value="" disabled selected>Selecione seu Bairro...</option>';
                    state.config.zones.forEach(z => {
                        const txt = z.price === 0 ? "Grátis" : `+R$ ${z.price.toFixed(2)}`;
                        sel.innerHTML += `<option value="${z.price}" data-name="${z.name}">${z.name} (${txt})</option>`;
                    });
                }
            }
            renderCart();
        };

        window.handlePaymentChange = () => {
            const method = document.getElementById('payment-method').value;
            const pixArea = document.getElementById('pix-area');
            state.paymentVerified = (method !== 'Pix');
            if(method === 'Pix') {
                pixArea.classList.remove('hidden');
                document.getElementById('pix-key').value = state.config.pixKey;
            } else {
                pixArea.classList.add('hidden');
            }
            validateCheckout();
        };

        window.confirmPix = () => {
            const btn = document.getElementById('btn-pix-confirm');
            btn.innerHTML = '<div class="spinner"></div>';
            setTimeout(() => {
                state.paymentVerified = true;
                btn.className = "w-full py-4 bg-green-500 text-white rounded-2xl text-xs font-bold flex items-center justify-center gap-2";
                btn.innerHTML = '<i data-lucide="check"></i> Confirmado';
                window.refreshIcons();
                validateCheckout();
            }, 600);
        };

        window.validateCheckout = () => {
            const btn = document.getElementById('btn-checkout');
            const name = document.getElementById('client-name').value;
            const phone = document.getElementById('client-phone').value;
            const method = document.getElementById('payment-method').value;
            let ok = name && phone.length > 10 && method && state.paymentVerified;
            if(state.deliveryType === 'Entrega' && (!document.getElementById('delivery-zone').value || !document.getElementById('client-address').value)) ok = false;
            btn.disabled = !ok;
            if(ok) {
                btn.className = "w-full py-5 rounded-2xl bg-gradient-to-r from-whatsapp-500 to-whatsapp-600 text-white font-black text-sm shadow-xl flex items-center justify-center gap-3 active:scale-95 transition-all";
                btn.innerHTML = '<i data-lucide="message-circle"></i> Finalizar no WhatsApp';
            } else {
                btn.className = "w-full py-5 rounded-2xl bg-slate-100 text-slate-400 font-bold text-sm flex items-center justify-center gap-3";
                btn.innerHTML = 'Faltam dados...';
            }
            window.refreshIcons();
        };

        window.sendOrder = async () => {
            const btn = document.getElementById('btn-checkout');
            btn.innerHTML = '<div class="spinner"></div>';
            const name = document.getElementById('client-name').value;
            const phone = document.getElementById('client-phone').value;
            const method = document.getElementById('payment-method').value;
            const total = document.getElementById('cart-total').innerText;
            
            let loc = "Retirada";
            let shippingDisplay = "Grátis";
            if(state.deliveryType === 'Entrega') {
                const zoneName = document.getElementById('delivery-zone').selectedOptions[0].getAttribute('data-name');
                const zonePrice = parseFloat(document.getElementById('delivery-zone').value || 0);
                loc = `${zoneName} - ${document.getElementById('client-address').value}`;
                shippingDisplay = zonePrice === 0 ? "Grátis" : `R$ ${zonePrice.toFixed(2)}`;
            }

            const items = state.cart.map(i => `${i.qty}x ${i.name}`).join(", ");
            const orderObj = { date: new Date().toISOString(), clientName: name, clientPhone: phone, itemsSummary: items, total, deliveryFee: shippingDisplay, paymentMethod: method, deliveryType: state.deliveryType, deliveryDetails: loc, status: 'new' };
            
            try { await addDoc(collection(db, "pedidos"), orderObj); } catch(e) {}

            if(state.config.googleScriptUrl) {
                const data = { nome: name, telefone: phone, total, taxa: shippingDisplay, pagamento: method, entrega: loc, itens: items };
                fetch(state.config.googleScriptUrl, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'text/plain' }, body: JSON.stringify(data) }).catch(e => {});
            }

            let msg = `🌟 *NOVO PEDIDO - AÇAÍ ELLEGANCE*\n\n👤 *Cliente:* ${name}\n📱 *Tel:* ${phone}\n\n*ITENS:* \n`;
            state.cart.forEach(i => msg += `• ${i.qty}x ${i.name} ${i.obs ? `_(${i.obs})_` : ''}\n`);
            msg += `\n📍 *${loc}*\n💳 *Pagamento:* ${method}\n🛵 *Taxa:* ${shippingDisplay}\n💰 *TOTAL: ${total}*`;
            
            if(method === 'Pix') {
                msg += `\n\n⚠️ *PAGAMENTO VIA PIX:*`;
                msg += `\n👤 *Nome:* Gabriel Santana Morais`;
                msg += `\n🔑 *Chave:* ${state.config.pixKey}`;
                msg += `\n\n🚫 *NÃO PRODUZIR SEM CONFERIR COMPROVANTE!*`;
            }

            state.cart = [];
            saveCart();
            window.open(`https://api.whatsapp.com/send?phone=${state.config.phone.replace(/\D/g,'')}&text=${encodeURIComponent(msg)}`, '_blank');
            setTimeout(() => window.location.reload(), 1500);
        };

        window.filterCategory = (cat) => {
            state.filter = cat;
            document.querySelectorAll('.cat-btn').forEach(b => {
                b.className = b.dataset.cat === cat ? "cat-btn active px-6 py-2.5 rounded-full text-xs font-black bg-brand-900 text-white shadow-lg whitespace-nowrap active:scale-95" : "cat-btn px-6 py-2.5 rounded-full text-xs font-black bg-white text-slate-500 border border-slate-200 whitespace-nowrap active:scale-95";
            });
            renderMenu();
        };

        window.filterMenu = renderMenu;
        window.updateQty = (d) => { state.qty = Math.max(1, state.qty + d); document.getElementById('qty-display').innerText = state.qty; updateTotalBar(); };
        window.toggleCart = (show) => {
            const drawer = document.getElementById('cart-drawer');
            const back = document.getElementById('cart-backdrop');
            if(show) { renderCart(); back.classList.remove('invisible', 'opacity-0'); drawer.classList.remove('translate-x-full'); }
            else { back.classList.add('opacity-0'); drawer.classList.add('translate-x-full'); setTimeout(() => back.classList.add('invisible'), 300); }
        };
        window.copyPix = () => { const k = document.getElementById('pix-key'); k.select(); document.execCommand('copy'); toast("Chave Pix Copiada!"); };
        window.toast = (m, t='success') => {
            const el = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = m;
            el.classList.remove('-translate-y-20', 'opacity-0');
            el.classList.add('translate-y-0', 'opacity-100');
            setTimeout(() => { el.classList.remove('translate-y-0', 'opacity-100'); el.classList.add('-translate-y-20', 'opacity-0'); }, 2500);
        };
        window.refreshIcons = () => { if (typeof lucide !== 'undefined') lucide.createIcons(); };
        window.updateUI = () => {
            const h = new Date().getHours();
            const isOpen = (state.config.statusMode === 'open') || (state.config.statusMode === 'auto' && h >= 16 && h < 23);
            const stDot = document.getElementById('status-indicator');
            const stTxt = document.getElementById('status-text');
            const stDotH = document.getElementById('status-dot');
            if (stDot) stDot.className = `absolute bottom-0 right-0 w-3.5 h-3.5 border-2 border-white rounded-full ${isOpen ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`;
            if (stDotH) stDotH.className = `w-1.5 h-1.5 rounded-full ${isOpen ? 'bg-green-500' : 'bg-red-500'}`;
            if (stTxt) {
                stTxt.innerText = isOpen ? "Aberto Agora" : "Fechado";
                stTxt.className = `text-[10px] font-bold uppercase tracking-wider ${isOpen ? 'text-green-600' : 'text-red-500'}`;
            }
        };
        window.setupPhoneMask = () => {
            const input = document.getElementById('client-phone');
            input.addEventListener('input', (e) => {
                let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
                e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
                validateCheckout();
            });
        };
        window.handleAdminClick = () => { if(state.isAdmin) showAdminPanel(); else document.getElementById('admin-modal').classList.remove('hidden'); };
        window.adminLogin = () => {
            const e = document.getElementById('adm-email').value;
            const p = document.getElementById('adm-pass').value;
            signInWithEmailAndPassword(auth, e, p).then(() => { document.getElementById('admin-modal').classList.add('hidden'); toast("Admin Logado"); }).catch(() => toast("Login Inválido", "error"));
        };
        window.showAdminPanel = () => { document.getElementById('admin-panel').classList.remove('hidden'); syncAdminFields(); };
        window.adminLogout = () => { signOut(auth); document.getElementById('admin-panel').classList.add('hidden'); toast("Admin Saiu"); };
        window.syncAdminFields = () => {
            document.getElementById('cfg-name').value = state.config.storeName;
            document.getElementById('cfg-phone').value = state.config.phone;
            document.getElementById('cfg-pix-key').value = state.config.pixKey;
            document.getElementById('cfg-pix-name').value = state.config.pixName;
            ['open','auto','closed'].forEach(m => {
                const btn = document.getElementById(`st-${m}`);
                if (btn) btn.className = `flex-1 py-4 rounded-2xl border-2 text-xs font-black ${state.config.statusMode === m ? 'border-brand-600 bg-brand-50 text-brand-700' : 'border-slate-100 text-slate-400'}`;
            });
            const list = document.getElementById('stock-list');
            if (list) {
                list.innerHTML = "";
                state.config.sizes.forEach((item, idx) => {
                    list.innerHTML += `<div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl text-xs border border-slate-100"><span class="${item.available===false ? 'line-through opacity-50' : 'font-bold'}">${item.name}</span><button onclick="toggleStock(${idx})" class="px-3 py-1.5 rounded-lg border font-bold ${item.available===false ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}">${item.available===false ? 'Ativar' : 'Pausar'}</button></div>`;
                });
            }
        };
        window.saveSettings = async () => {
            const newConfig = { ...state.config, storeName: document.getElementById('cfg-name').value, phone: document.getElementById('cfg-phone').value, pixKey: document.getElementById('cfg-pix-key').value, pixName: document.getElementById('cfg-pix-name').value };
            try { await updateDoc(doc(db, 'loja', 'configuracao'), newConfig); toast("Configurações Salvas!"); } catch(e) { toast("Erro ao salvar!", "error"); }
        };
        window.toggleStock = async (idx) => {
            const newSizes = [...state.config.sizes];
            newSizes[idx].available = !(newSizes[idx].available !== false);
            await updateDoc(doc(db, 'loja', 'configuracao'), { sizes: newSizes });
        };
        window.setStatus = async (mode) => { await updateDoc(doc(db, 'loja', 'configuracao'), { statusMode: mode }); toast("Status Atualizado!"); };
        window.onload = init;
    </script>
</body>
</html>
